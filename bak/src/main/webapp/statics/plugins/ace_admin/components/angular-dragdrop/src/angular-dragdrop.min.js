/**
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
!function(a,b,c,d){"use strict";var e=b.module("ngDragDrop",[]).service("ngDragDropService",["$timeout","$parse","$q",function(f,g,h){this.draggableScope=null,this.droppableScope=null,c("head").prepend('<style type="text/css">@charset "UTF-8";.angular-dragdrop-hide{display: none !important;}</style>'),this.callEventCallback=function(a,b,d,e){function f(b){var d=-1!==b.indexOf("(")?b.indexOf("("):b.length,e=-1!==b.lastIndexOf(")")?b.lastIndexOf(")"):b.length,f=b.substring(d+1,e),h=-1!==b.indexOf(".")?b.substr(0,b.indexOf(".")):null;return h=a[h]&&"function"==typeof a[h].constructor?h:null,{callback:b.substring(h&&h.length+1||0,d),args:c.map(f&&f.split(",")||[],function(b){return[g(b)(a)]}),constructor:h}}if(b){var h=f(b),i=h.callback,j=h.constructor,k=[d,e].concat(h.args);return(a[i]||a[j][i]).apply(a[i]?a:a[j],k)}},this.invokeDrop=function(a,g,i,j){var k,l,m,n="",o="",p={},q={},r=null,s={},t={},u=null,v=this.droppableScope,w=this.draggableScope,x=null,y=[];n=a.ngattr("ng-model"),o=g.ngattr("ng-model"),k=w.$eval(n),l=v.$eval(o),u=g.find("[jqyoui-draggable]:last,[data-jqyoui-draggable]:last"),q=v.$eval(g.attr("jqyoui-droppable")||g.attr("data-jqyoui-droppable"))||[],p=w.$eval(a.attr("jqyoui-draggable")||a.attr("data-jqyoui-draggable"))||[],p.index=this.fixIndex(w,p,k),q.index=this.fixIndex(v,q,l),r=b.isArray(k)?p.index:null,s=b.isArray(k)?k[r]:k,p.deepCopy&&(s=b.copy(s)),t=b.isArray(l)&&q&&q.index!==d?l[q.index]:b.isArray(l)?{}:l,q.deepCopy&&(t=b.copy(t)),p.beforeDrop&&y.push(this.callEventCallback(w,p.beforeDrop,i,j)),h.all(y).then(b.bind(this,function(){if(p.insertInline&&n===o){if(p.index>q.index){m=k[p.index];for(var d=p.index;d>q.index;d--)l[d]=b.copy(l[d-1]),l[d-1]={},l[d][p.direction]="left";l[q.index]=m}else{m=k[p.index];for(var d=p.index;d<q.index;d++)l[d]=b.copy(l[d+1]),l[d+1]={},l[d][p.direction]="right";l[q.index]=m}this.callEventCallback(v,q.onDrop,i,j)}else p.animate===!0?(x=a.clone(),x.css({position:"absolute"}).css(a.offset()),c("body").append(x),a.addClass("angular-dragdrop-hide"),this.move(x,u.length>0?u:g,null,"fast",q,function(){x.remove()}),this.move(u.length>0&&!q.multiple?u:[],a.parent("[jqyoui-droppable],[data-jqyoui-droppable]"),e.startXY,"fast",q,b.bind(this,function(){f(b.bind(this,function(){a.css({position:"relative",left:"",top:""}).removeClass("angular-dragdrop-hide"),u.css({position:"relative",left:"",top:"",display:"none"===u.css("display")?"":u.css("display")}),this.mutateDraggable(w,q,p,n,o,t,a),this.mutateDroppable(v,q,p,o,s,r),this.callEventCallback(v,q.onDrop,i,j)}))}))):f(b.bind(this,function(){this.mutateDraggable(w,q,p,n,o,t,a),this.mutateDroppable(v,q,p,o,s,r),this.callEventCallback(v,q.onDrop,i,j)}))}))["finally"](b.bind(this,function(){this.restore(a)}))},this.move=function(b,c,e,f,g,h){if(0===b.length)return h&&a.setTimeout(function(){h()},300),!1;var i=b.css("z-index"),j=b[g.containment||"offset"](),k=c.css("display"),l=c.hasClass("ng-hide"),m=c.hasClass("angular-dragdrop-hide");null===e&&c.length>0&&((c.attr("jqyoui-draggable")||c.attr("data-jqyoui-draggable"))!==d&&c.ngattr("ng-model")!==d&&c.is(":visible")&&g&&g.multiple?(e=c[g.containment||"offset"](),g.stack===!1?e.left+=c.outerWidth(!0):e.top+=c.outerHeight(!0)):(l&&c.removeClass("ng-hide"),m&&c.removeClass("angular-dragdrop-hide"),e=c.css({visibility:"hidden",display:"block"})[g.containment||"offset"](),c.css({visibility:"",display:k}))),b.css({position:"absolute","z-index":9999}).css(j).animate(e,f,function(){l&&c.addClass("ng-hide"),m&&c.addClass("angular-dragdrop-hide"),b.css("z-index",i),h&&h()})},this.mutateDroppable=function(a,c,d,e,f,h){var i=a.$eval(e);a.dndDragItem=f,b.isArray(i)?(c&&c.index>=0?i[c.index]=f:i.push(f),d&&d.placeholder===!0&&(i[i.length-1].jqyoui_pos=h)):(g(e+" = dndDragItem")(a),d&&d.placeholder===!0&&(i.jqyoui_pos=h))},this.mutateDraggable=function(a,c,e,f,h,i,j){var k=b.equals(i,{})||!i,l=a.$eval(f);a.dndDropItem=i,e&&e.placeholder?"keep"!=e.placeholder&&(b.isArray(l)&&e.index!==d?l[e.index]=i:g(f+" = dndDropItem")(a)):b.isArray(l)?k?e&&e.placeholder!==!0&&"keep"!==e.placeholder&&l.splice(e.index,1):l[e.index]=i:(g(f+" = dndDropItem")(a),a.$parent&&g(f+" = dndDropItem")(a.$parent)),this.restore(j)},this.restore=function(a){a.css({"z-index":"",left:"",top:""})},this.fixIndex=function(a,c,e){if(c.applyFilter&&b.isArray(e)&&e.length>0){var f=a[c.applyFilter](),g=f[c.index],h=d;return e.forEach(function(a,c){b.equals(a,g)&&(h=c)}),h}return c.index}}]).directive("jqyouiDraggable",["ngDragDropService",function(a){return{require:"?jqyouiDroppable",restrict:"A",link:function(d,f,g){var h,i,j,k,l=c(f),m=function(f,m){f?(h=d.$eval(l.attr("jqyoui-draggable")||l.attr("data-jqyoui-draggable"))||{},i=d.$eval(g.jqyouiOptions)||{},l.draggable({disabled:!1}).draggable(i).draggable({start:function(b,f){a.draggableScope=d,j=c(i.helper?f.helper:this).css("z-index"),c(i.helper?f.helper:this).css("z-index",9999),e.startXY=c(this)[h.containment||"offset"](),a.callEventCallback(d,h.onStart,b,f)},stop:function(b,e){c(i.helper?e.helper:this).css("z-index",j),a.callEventCallback(d,h.onStop,b,e)},drag:function(b,c){a.callEventCallback(d,h.onDrag,b,c)}})):l.draggable({disabled:!0}),k&&b.isDefined(f)&&(b.equals(g.drag,"true")||b.equals(g.drag,"false"))&&(k(),k=null)};k=d.$watch(function(){return d.$eval(g.drag)},m),m(),l.on("$destroy",function(){l.draggable({disabled:!0}).draggable("destroy")})}}}]).directive("jqyouiDroppable",["ngDragDropService","$q",function(a,d){return{restrict:"A",priority:1,link:function(e,f,g){var h,i,j,k=c(f),l=function(f,l){f?(h=e.$eval(c(k).attr("jqyoui-droppable")||c(k).attr("data-jqyoui-droppable"))||{},i=e.$eval(g.jqyouiOptions)||{},k.droppable({disabled:!1}).droppable(i).droppable({over:function(b,c){a.callEventCallback(e,h.onOver,b,c)},out:function(b,c){a.callEventCallback(e,h.onOut,b,c)},drop:function(f,j){var k=null;k=h.beforeDrop?a.callEventCallback(e,h.beforeDrop,f,j):function(){var a=d.defer();return a.resolve(),a.promise}(),k.then(b.bind(this,function(){c(j.draggable).ngattr("ng-model")&&g.ngModel?(a.droppableScope=e,a.invokeDrop(c(j.draggable),c(this),f,j)):a.callEventCallback(e,h.onDrop,f,j)}),function(){j.draggable.animate({left:"",top:""},i.revertDuration||0)})}})):k.droppable({disabled:!0}),j&&b.isDefined(f)&&(b.equals(g.drop,"true")||b.equals(g.drop,"false"))&&(j(),j=null)};j=e.$watch(function(){return e.$eval(g.drop)},l),l(),k.on("$destroy",function(){k.droppable({disabled:!0}).droppable("destroy")})}}}]);c.fn.ngattr=function(a,b){var c=this[0];return c.getAttribute(a)||c.getAttribute("data-"+a)}}(window,window.angular,window.jQuery);